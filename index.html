<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سوق باي - souq-pi-app</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; transition: direction 0.3s; }
        header { background-color: #333; color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
        nav ul { list-style: none; display: flex; gap: 20px; padding: 0; }
        nav a { color: white; text-decoration: none; }
        .lang-switch button { padding: 8px 15px; cursor: pointer; background-color: #f39c12; border: none; color: white; border-radius: 5px; font-weight: bold; }
        .content { padding: 20px; text-align: center; }
        #pay-button { padding: 15px 30px; background-color: #f39c12; color: white; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; display: block; margin: 20px auto; }
    </style>
</head>
<body>

<header>
    <div class="logo"><h2 id="site-title">سوق باي</h2></div>
    <nav>
        <ul>
            <li><a href="index.html" id="nav-home">الرئيسية</a></li>
            <li><a href="projects.html" id="nav-projects">المشاريع</a></li>
            <li><a href="blog.html" id="nav-blog">المدونة</a></li>
            <li><a href="cv.html" id="nav-cv">السيرة الذاتية</a></li>
        </ul>
    </nav>
    <div class="lang-switch"><button id="lang-btn" onclick="toggleLanguage()">English</button></div>
</header>

<div class="content">
    <h1 id="welcome-msg">مرحباً بك في تطبيق سوق باي</h1>
    <p id="description">هذا هو المجلد الرئيسي للمشروع بعد تنظيم الملفات.</p>
    <img src="iphone.jpg" alt="iPhone" style="max-width: 200px; margin-top: 20px;">
    
    <button id="pay-button">شراء المنتج (1 Pi)</button>
</div>

<script src="https://sdk.minepi.com/pi-sdk.js"></script>
<script>
    const Pi = window.Pi;
    Pi.init({ version: "2.0", sandbox: true }); 

    function toggleLanguage() {
        const htmlTag = document.documentElement;
        const btn = document.getElementById('lang-btn');
        const home = document.getElementById('nav-home');
        const welcome = document.getElementById('welcome-msg');
        const payBtn = document.getElementById('pay-button');

        if (htmlTag.dir === "rtl") {
            htmlTag.dir = "ltr";
            btn.innerText = "العربية";
            welcome.innerText = "Welcome to Souq Pi";
            payBtn.innerText = "Buy Product (1 Pi)";
        } else {
            htmlTag.dir = "rtl";
            btn.innerText = "English";
            welcome.innerText = "مرحباً بك في تطبيق سوق باي";
            payBtn.innerText = "شراء المنتج (1 Pi)";
        }
    }

    document.getElementById('pay-button').onclick = async function() {
        try {
            const payment = await Pi.createPayment({
                amount: 1,
                memo: "طلب شراء من سوق باي",
                metadata: { productId: "pi-item-001" }
            }, {
                onReadyForServerApproval: (paymentId) => {
                    // تصحيح المسار ليرتبط بمجلد api الجديد
                    return fetch('/api/index', { 
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ paymentId })
                    });
                },
                onReadyForServerCompletion: (paymentId, txid) => {
                    alert("تم الدفع بنجاح! رقم العملية: " + txid);
                },
                onCancel: (paymentId) => { console.log("إلغاء"); },
                onError: (error) => { alert("خطأ: " + error.message); }
            });
        } catch (err) {
            alert("خطأ في النظام: " + err.message);
        }
    };
</script>
</body>
</html>